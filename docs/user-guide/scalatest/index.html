<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>ScalaTest Integration · scala3mock</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## Integration"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="ScalaTest Integration · scala3mock"/><meta property="og:type" content="website"/><meta property="og:url" content="https://francois.monniot.eu/scala3mock/"/><meta property="og:description" content="## Integration"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/scala3mock/img/favicon.png"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github-gist.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/scala3mock/js/scrollSpy.js"></script><link rel="stylesheet" href="/scala3mock/css/main.css"/><script src="/scala3mock/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/scala3mock/"><img class="logo" src="/scala3mock/img/logo.svg" alt="scala3mock"/><h2 class="headerTitleWithLogo">scala3mock</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/scala3mock/docs/getting-started" target="_self">Docs</a></li><li class=""><a href="https://github.com/fmonniot/scala3mock" target="_blank">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>User Guide</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Overview</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala3mock/docs/getting-started">Getting Started</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">User Guide</h3><ul class=""><li class="navListItem"><a class="navItem" href="/scala3mock/docs/user-guide/features">Features</a></li><li class="navListItem"><a class="navItem" href="/scala3mock/docs/user-guide/matching">Argument matching</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/scala3mock/docs/user-guide/scalatest">ScalaTest Integration</a></li><li class="navListItem"><a class="navItem" href="/scala3mock/docs/user-guide/advanced-topics">Advanced Topics</a></li><li class="navListItem"><a class="navItem" href="/scala3mock/docs/user-guide/faq">FAQ</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">ScalaTest Integration</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="integration"></a><a href="#integration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Integration</h2>
<p>To provide mocking support in ScalaTest, extends your suite with <code>eu.monniot.scala3mock.scalatest.MockFactory</code>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> org.scalatest.flatspec.<span class="hljs-type">AnyFlatSpec</span>
<span class="hljs-keyword">import</span> eu.monniot.scala3mock.scalatest.<span class="hljs-type">MockFactory</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoffeeMachineTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnyFlatSpec</span> <span class="hljs-keyword">with</span> <span class="hljs-title">MockFactory</span> </span>{

  <span class="hljs-string">"CoffeeMachine"</span> should <span class="hljs-string">"not turn on the heater when the water container is empty"</span> in {
      <span class="hljs-keyword">val</span> waterContainerMock = mock[<span class="hljs-type">WaterContainer</span>]
      when(() =&gt; waterContainerMock.isEmpty).expects().returning(<span class="hljs-literal">true</span>)
      <span class="hljs-comment">// ...</span>
  }
}
</code></pre>
<p>When using the asynchronous version, please use <code>eu.monniot.scala3mock.scalatest.AsyncMockFactory</code> instead:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> org.scalatest.flatspec.<span class="hljs-type">AsyncFlatSpec</span>
<span class="hljs-keyword">import</span> eu.monniot.scala3mock.scalatest.<span class="hljs-type">AsyncMockFactory</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExchangeRateListingTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncFlatSpec</span> <span class="hljs-keyword">with</span> <span class="hljs-title">AsyncMockFactory</span> </span>{

  <span class="hljs-keyword">val</span> eur = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"EUR"</span>, valueToUSD = <span class="hljs-number">1.0531</span>, change = <span class="hljs-number">-0.0016</span>)
  <span class="hljs-keyword">val</span> gpb = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"GPB"</span>, valueToUSD = <span class="hljs-number">1.2280</span>, change = <span class="hljs-number">-0.0012</span>)
  <span class="hljs-keyword">val</span> aud = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"AUD"</span>, valueToUSD = <span class="hljs-number">0.7656</span>, change = <span class="hljs-number">-0.0024</span>)

  <span class="hljs-string">"ExchangeRateListing"</span> should <span class="hljs-string">"eventually return the exchange rate between passed Currencies when getExchangeRate is invoked"</span> in {
      <span class="hljs-keyword">val</span> currencyDatabaseMock = mock[<span class="hljs-type">CurrencyDatabase</span>]
      
      when(currencyDatabaseMock.getCurrency).expects(eur.id).returns(eur)
      when(currencyDatabaseMock.getCurrency).expects(gpb.id).returns(gpb)
      when(currencyDatabaseMock.getCurrency).expects(aud.id).returns(aud)
      
      <span class="hljs-keyword">val</span> listing = <span class="hljs-type">ExchangeRateListing</span>(currencyDatabaseMock)
      
      <span class="hljs-keyword">val</span> future: <span class="hljs-type">Future</span>[<span class="hljs-type">Double</span>] = listing.getExchangeRate(eur.id, gpb.id)

      future.map { exchangeRate =&gt;
        assert(exchangeRate == eur.valueToUSD / gpb.valueToUSD)
    }
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="sharing-mocks-and-expectations-in-scalatest"></a><a href="#sharing-mocks-and-expectations-in-scalatest" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Sharing mocks and expectations in ScalaTest</h2>
<p>Sometimes multiple test cases will require the same mocks (and more generally the same fixtures like databases, sockets). There are many ways to achieve that goal, Scala3Mock officialy support only two:</p>
<ul>
<li><em>isolated test cases</em>: clean and simple, recommended when all tests have the same or very similar mocks</li>
<li><em>fixture contexts</em>: more flexible, recommended for complex test suites when a single set of mocks does not fit all test cases</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="isolated-test-cases"></a><a href="#isolated-test-cases" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Isolated test cases</h3>
<p>If you mix the <code>org.scalatest.OneInstancePerTest</code> trait to your test suite, each test case will be run in its own instance of the class suite. That means each test will get a different copy of the instance variables.</p>
<p>In the suite scope, you can</p>
<ul>
<li>declare instance variables (eg. mocks) that will be used by multiple test cases, and</li>
<li>perform common test cases setup (eg. set up various mock expectations).</li>
</ul>
<p>Because each test case has its own instance, different test cases do not interfere with each other.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> org.scalatest.<span class="hljs-type">OneInstancePerTest</span>
<span class="hljs-keyword">import</span> org.scalatest.matchers.should.<span class="hljs-type">Matchers</span>

<span class="hljs-comment">// Please note that this test suite mixes in OneInstancePerTest</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoffeeMachineTest2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnyFlatSpec</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Matchers</span> <span class="hljs-keyword">with</span> <span class="hljs-title">OneInstancePerTest</span> <span class="hljs-keyword">with</span> <span class="hljs-title">MockFactory</span> </span>{
   <span class="hljs-comment">// shared objects</span>
   <span class="hljs-keyword">val</span> waterContainerMock = mock[<span class="hljs-type">WaterContainer</span>]
   <span class="hljs-keyword">val</span> heaterMock = mock[<span class="hljs-type">Heater</span>]
   <span class="hljs-keyword">val</span> coffeeMachine = <span class="hljs-type">CoffeeMachine</span>(waterContainerMock, heaterMock)
   
   <span class="hljs-comment">// you can set common expectations in the suite scope</span>
   when(() =&gt; heaterMock.isReady).expects().returning(<span class="hljs-literal">true</span>)
   
   <span class="hljs-comment">// and perform common test setup</span>
   coffeeMachine.powerOn()
   
   <span class="hljs-string">"CoffeeMachine"</span> should <span class="hljs-string">"not turn on the heater when the water container is empty"</span> in {
       coffeeMachine.isOn shouldBe <span class="hljs-literal">true</span>
       when(() =&gt; waterContainerMock.isEmpty).expects().returning(<span class="hljs-literal">true</span>)
        
       <span class="hljs-comment">// ...</span>
       coffeeMachine.powerOff()
       coffeeMachine.isOn shouldBe <span class="hljs-literal">false</span>
   }
   
   it should <span class="hljs-string">"not turn on the heater when the water container is overfull"</span> in {
       <span class="hljs-comment">// each test case uses a separate, fresh test suite so the coffee machine is turned on</span>
       <span class="hljs-comment">// even if previous test case turned it off</span>
       coffeeMachine.isOn shouldBe <span class="hljs-literal">true</span>
       <span class="hljs-comment">// ...</span>
   }
}
</code></pre>
<p>Note that if you need to create costly fixtures (eg. establish a database connection), this strategy will duplicate that costly work by the amount of tests. In those cases, we instead recommend to use fixture contexts.</p>
<h3><a class="anchor" aria-hidden="true" id="fixture-contexts"></a><a href="#fixture-contexts" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fixture contexts</h3>
<p>Another way of sharing complex context between tests is to have separate fixture context. In practice that means creating a new trait/class that is instantiated per test. Because each test has its own instance, the context isn't shared between tests and because there is only one class suite you can use it to store common and expensive fixtures.</p>
<p>It's really easy to apply to regular test suites:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CoffeeMachineTest3</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AnyFlatSpec</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Matchers</span> <span class="hljs-keyword">with</span> <span class="hljs-title">MockFactory</span> </span>{
   <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Test</span> </span>{ <span class="hljs-comment">// fixture context</span>
       <span class="hljs-comment">// shared objects</span>
       <span class="hljs-keyword">val</span> waterContainerMock = mock[<span class="hljs-type">WaterContainer</span>]
       <span class="hljs-keyword">val</span> heaterMock = mock[<span class="hljs-type">Heater</span>]
       <span class="hljs-keyword">val</span> coffeeMachine = <span class="hljs-type">CoffeeMachine</span>(waterContainerMock, heaterMock)
   
       <span class="hljs-comment">// test setup</span>
       coffeeMachine.powerOn()
   }
   
   <span class="hljs-string">"CoffeeMachine"</span> should <span class="hljs-string">"not turn on the heater when the water container is empty"</span> in <span class="hljs-keyword">new</span> <span class="hljs-type">Test</span> {
       coffeeMachine.isOn shouldBe <span class="hljs-literal">true</span>
       when(() =&gt; waterContainerMock.isEmpty).expects().returning(<span class="hljs-literal">true</span>)
       <span class="hljs-comment">// ...</span>
   }
   
   <span class="hljs-comment">// you can extend and combine fixture-contexts</span>
   <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">OverfullWaterContainerTest</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Test</span> </span>{
       <span class="hljs-comment">// you can set expectations and use mocks in the fixture-context</span>
       when(() =&gt; waterContainerMock.isOverfull).expects().returning(<span class="hljs-literal">true</span>)
   
       <span class="hljs-comment">// and define helper functions</span>
       <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sharedComplexLogic</span></span>(): <span class="hljs-type">Unit</span> = {
         coffeeMachine.powerOff()
         <span class="hljs-comment">// ...</span>
       }
   }
   
   it should <span class="hljs-string">"not turn on the heater when the water container is overfull"</span> in <span class="hljs-keyword">new</span> <span class="hljs-type">OverfullWaterContainerTest</span> {
       <span class="hljs-comment">// ...</span>
       sharedComplexLogic()
   }
}
</code></pre>
<p>This pattern can also be used with async test suite, but because those needs to return a <code>Future</code> (or equivalent) we cannot just return the fixture context directly.</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ExchangeRateListingTest2</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">AsyncFlatSpec</span> <span class="hljs-keyword">with</span> <span class="hljs-title">AsyncMockFactory</span> </span>{

  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Context</span> </span>{
    <span class="hljs-keyword">val</span> eur = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"EUR"</span>, valueToUSD = <span class="hljs-number">1.0531</span>, change = <span class="hljs-number">-0.0016</span>)
    <span class="hljs-keyword">val</span> gpb = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"GPB"</span>, valueToUSD = <span class="hljs-number">1.2280</span>, change = <span class="hljs-number">-0.0012</span>)
    <span class="hljs-keyword">val</span> aud = <span class="hljs-type">Currency</span>(id = <span class="hljs-string">"AUD"</span>, valueToUSD = <span class="hljs-number">0.7656</span>, change = <span class="hljs-number">-0.0024</span>)

    <span class="hljs-keyword">val</span> currencyDatabaseMock = mock[<span class="hljs-type">CurrencyDatabase</span>]
    
    when(currencyDatabaseMock.getCurrency).expects(eur.id).returns(eur)
    when(currencyDatabaseMock.getCurrency).expects(gpb.id).returns(gpb)
    when(currencyDatabaseMock.getCurrency).expects(aud.id).returns(aud)
    
    <span class="hljs-keyword">val</span> listing = <span class="hljs-type">ExchangeRateListing</span>(currencyDatabaseMock)
  }


  <span class="hljs-string">"ExchangeRateListing"</span> should <span class="hljs-string">"eventually return the exchange rate between passed Currencies when getExchangeRate is invoked"</span> in {
      <span class="hljs-keyword">val</span> ctx = <span class="hljs-type">Context</span>()

      <span class="hljs-keyword">val</span> future: <span class="hljs-type">Future</span>[<span class="hljs-type">Double</span>] = ctx.listing.getExchangeRate(ctx.eur.id, ctx.gpb.id)

      future.map { exchangeRate =&gt;
        assert(exchangeRate == ctx.eur.valueToUSD / ctx.gpb.valueToUSD)
    }
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="advanced"></a><a href="#advanced" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advanced</h2>
<blockquote>
<p>TODO: how it works under the hood. Give context to debug some weird errors if the <code>MockContext</code> is
either not available or corrupted.</p>
</blockquote>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/scala3mock/docs/user-guide/matching"><span class="arrow-prev">← </span><span>Argument matching</span></a><a class="docs-next button" href="/scala3mock/docs/user-guide/advanced-topics"><span>Advanced Topics</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#integration">Integration</a></li><li><a href="#sharing-mocks-and-expectations-in-scalatest">Sharing mocks and expectations in ScalaTest</a><ul class="toc-headings"><li><a href="#isolated-test-cases">Isolated test cases</a></li><li><a href="#fixture-contexts">Fixture contexts</a></li></ul></li><li><a href="#advanced">Advanced</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/scala3mock/" class="nav-home"><img src="/scala3mock/img/logo.svg" alt="scala3mock" width="66" height="58"/></a><div><h5>Docs</h5><a href="/scala3mock/docs/getting-started">Getting Started</a><a href="/scala3mock/docs/faq">FAQ</a></div></section><section class="copyright">Copyright (c) 2022-2023 François Monniot</section></footer></div></body></html>